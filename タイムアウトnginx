Nginxで504 Gateway Timeoutエラーが発生する可能性がある場合、特にバックエンドサーバー（例えば、SSRのページを処理しているNext.jsサーバー）からの応答に長時間かかる場合、いくつかのタイムアウト設定が関係してきます。以下に、主に関係するNginxのタイムアウト設定をリストアップし、それぞれの役割を説明します。

### 1. **`proxy_read_timeout`**
   - **説明**: Nginxがバックエンドサーバーからの応答を待つ最大時間を指定します。この時間を超えると、Nginxは504エラーを返します。
   - **デフォルト**: 60秒
   - **関係**: SSRページの処理に180秒かかる場合、`proxy_read_timeout`が60秒だと、60秒経過時点で504エラーが発生します。
   - **設定例**:
     ```nginx
     proxy_read_timeout 180s;
     ```

### 2. **`proxy_connect_timeout`**
   - **説明**: Nginxがバックエンドサーバーに接続を確立するまでの最大時間を指定します。この時間内に接続が確立しないと、504エラーが発生します。
   - **デフォルト**: 60秒
   - **関係**: サーバーへの接続自体に時間がかかる場合に影響しますが、SSRページの処理時間には直接関係しません。
   - **設定例**:
     ```nginx
     proxy_connect_timeout 180s;
     ```

### 3. **`proxy_send_timeout`**
   - **説明**: Nginxがバックエンドサーバーにリクエストを送信する際、すべてのデータを送信するまでの最大時間を指定します。データの送信がこの時間内に完了しないと、504エラーが発生します。
   - **デフォルト**: 60秒
   - **関係**: クライアントからのリクエストをバックエンドに送信する際に適用されるため、特に大きなリクエストや送信時間がかかる場合に影響しますが、SSRページの処理時間には直接関係しません。
   - **設定例**:
     ```nginx
     proxy_send_timeout 180s;
     ```

### 4. **`client_body_timeout`**
   - **説明**: クライアントがリクエストボディを送信するのをNginxが待つ最大時間を指定します。この時間内にクライアントがリクエストボディを送信しないと、Nginxは408エラーを返します。
   - **デフォルト**: 60秒
   - **関係**: クライアントからのデータ送信に関するタイムアウトです。SSR処理とは直接関係しません。

### 5. **`send_timeout`**
   - **説明**: Nginxがクライアントにレスポンスを送信する際、すべてのデータを送信するまでの最大時間を指定します。レスポンス送信がこの時間内に完了しないと接続が切断されますが、通常504エラーは発生しません。
   - **デフォルト**: 60秒
   - **関係**: クライアントへのデータ送信に関するタイムアウトです。SSR処理とは直接関係しません。

### 6. **`keepalive_timeout`**
   - **説明**: クライアントとNginxの間の接続がアイドル状態になった場合に接続を保持する時間を指定します。このタイムアウトは、再利用可能な接続に対して適用されますが、バックエンド処理時間とは直接関係しません。
   - **デフォルト**: 75秒
   - **関係**: 接続保持に関する設定です。SSR処理とは直接関係しません。

### まとめ

SSRページの処理に180秒かかる場合、特に注意すべきタイムアウト設定は以下の3つです。

1. **`proxy_read_timeout`**: バックエンドサーバーからの応答を待つ時間。これが60秒に設定されている場合、180秒かかる処理では60秒経過後に504エラーが発生します。

2. **`proxy_connect_timeout`**: バックエンドサーバーに接続するまでの時間。ただし、接続そのものが問題ない場合、SSRの遅延とは直接関係しません。

3. **`proxy_send_timeout`**: Nginxがバックエンドにリクエストを送信する時間。SSR処理が長時間かかる場合、これも適切に設定する必要があります。

最も影響が大きいのは `proxy_read_timeout` です。SSR処理が180秒かかる場合は、少なくともこの値を180秒以上に設定する必要があります。